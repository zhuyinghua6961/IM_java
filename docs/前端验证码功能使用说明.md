# 前端验证码功能使用说明

## 📋 功能概述

前端已实现完整的验证码登录注册功能，包括：
1. ✅ **Tab切换**：密码登录 / 验证码登录
2. ✅ **发送验证码**：60秒倒计时
3. ✅ **注册验证**：必须使用手机号+验证码
4. ✅ **智能登录**：支持用户名或手机号+密码

---

## 🎨 界面展示

### 登录页面

#### 1. 密码登录（默认）
- 输入：用户名或手机号 + 密码
- 自动识别：输入11位手机号则使用手机号登录，否则使用用户名登录

#### 2. 验证码登录
- 输入：手机号 + 验证码
- 点击"获取验证码"按钮
- 60秒倒计时防重复发送
- 提示查看控制台日志获取验证码

### 注册对话框

- ✅ 手机号（必填，带验证码）
- ✅ 验证码（必填，6位数字）
- ✅ 用户名（必填，3-20字符）
- ✅ 密码（必填，6-20字符）
- ✅ 确认密码（必填）
- ✅ 昵称（必填）

---

## 🔧 核心功能

### 1. 登录方式切换

```vue
<el-tabs v-model="loginType">
  <el-tab-pane label="密码登录" name="password"></el-tab-pane>
  <el-tab-pane label="验证码登录" name="sms"></el-tab-pane>
</el-tabs>
```

### 2. 验证码倒计时

```javascript
// 60秒倒计时
countdown.value = 60
const timer = setInterval(() => {
  countdown.value--
  if (countdown.value <= 0) {
    clearInterval(timer)
  }
}, 1000)
```

### 3. 智能登录

```javascript
// 自动判断是用户名还是手机号
const isPhone = /^1[3-9]\d{9}$/.test(form.account)
if (isPhone) {
  loginData.phone = form.account
} else {
  loginData.username = form.account
}
```

---

## 📝 使用流程

### 场景1：新用户注册

1. 点击"立即注册"打开注册对话框
2. 输入手机号
3. 点击"获取验证码"，查看后端控制台获取验证码
4. 输入验证码、用户名、密码、昵称
5. 点击"注册"
6. 注册成功后自动填充用户名到登录表单

**提示**：
```
验证码会显示在后端控制台：
========================================
【短信验证码】
手机号: 13800138001
验证码: 847263
有效期: 5 分钟
========================================
```

### 场景2：用户名密码登录

1. 选择"密码登录"tab（默认）
2. 输入用户名或手机号
3. 输入密码
4. 点击"登录"或按回车

### 场景3：手机号验证码登录

1. 选择"验证码登录"tab
2. 输入手机号
3. 点击"获取验证码"
4. 从后端控制台复制验证码
5. 输入验证码
6. 点击"登录"或按回车

---

## 🎯 表单验证规则

### 登录表单

**密码登录模式**：
- `account`：必填
- `password`：必填

**验证码登录模式**：
- `phone`：必填，格式：1[3-9]开头的11位数字
- `code`：必填，6位数字

### 注册表单

- `phone`：必填，格式：1[3-9]开头的11位数字
- `code`：必填，6位数字
- `username`：必填，3-20个字符
- `password`：必填，6-20个字符
- `confirmPassword`：必填，需与密码一致
- `nickname`：必填

---

## 🔒 安全特性

### 1. 防重复发送
- 60秒倒计时
- 倒计时期间按钮禁用
- 显示剩余秒数

### 2. 表单验证
- 实时验证手机号格式
- 验证码长度校验
- 密码确认一致性校验

### 3. 错误提示
- 手机号格式不正确
- 验证码为空或格式错误
- 两次密码不一致

---

## 📊 数据流转

### 密码登录流程

```
用户输入
  ↓
表单验证
  ↓
判断输入类型（手机号/用户名）
  ↓
构造登录数据：
{
  loginType: "password",
  username/phone: "xxx",
  password: "xxx"
}
  ↓
调用 /api/user/login
  ↓
保存Token和用户信息
  ↓
跳转到首页
```

### 验证码登录流程

```
用户输入手机号
  ↓
点击"获取验证码"
  ↓
调用 /api/user/sms/send
  ↓
后端返回成功，验证码打印在控制台
  ↓
开始60秒倒计时
  ↓
用户输入验证码
  ↓
构造登录数据：
{
  loginType: "sms",
  phone: "xxx",
  code: "xxx"
}
  ↓
调用 /api/user/login
  ↓
验证成功，保存Token
  ↓
跳转到首页
```

### 注册流程

```
用户输入手机号
  ↓
点击"获取验证码"
  ↓
查看后端控制台获取验证码
  ↓
填写完整表单
  ↓
提交注册：
{
  phone: "xxx",
  code: "xxx",
  username: "xxx",
  password: "xxx",
  nickname: "xxx"
}
  ↓
调用 /api/user/register
  ↓
注册成功
  ↓
关闭对话框，自动填充用户名到登录表单
```

---

## 🎨 UI组件

### 验证码输入组

```vue
<div class="code-input-group">
  <el-input v-model="form.code" />
  <el-button :disabled="countdown > 0">
    {{ countdown > 0 ? `${countdown}秒后重试` : '获取验证码' }}
  </el-button>
</div>
```

**样式**：
```css
.code-input-group {
  display: flex;
  gap: 10px;
}

.code-input-group .el-input {
  flex: 1;
}

.code-btn {
  min-width: 120px;
  white-space: nowrap;
}
```

---

## 💡 开发提示

### 1. 获取验证码

验证码不会真正发送短信，需要查看**后端服务控制台**：

```bash
# 启动用户服务
cd im-user-service
mvn spring-boot:run

# 查看控制台输出的验证码
```

### 2. 测试账号

可以使用以下测试账号登录：
- 用户名: `admin` / 密码: `123456`
- 用户名: `user001` / 密码: `123456`

### 3. 调试技巧

```javascript
// 在浏览器控制台查看登录数据
console.log('登录数据:', loginData)

// 查看表单验证状态
formRef.value.validate((valid) => {
  console.log('表单验证结果:', valid)
})
```

---

## 🐛 常见问题

### Q1: 点击"获取验证码"没反应？
**A**: 检查：
1. 手机号格式是否正确
2. 浏览器控制台是否有错误
3. 后端服务是否正常运行

### Q2: 验证码在哪里查看？
**A**: 验证码打印在**后端服务的控制台**，不是浏览器控制台

### Q3: 倒计时不归零？
**A**: 刷新页面即可重置倒计时

### Q4: 注册成功后怎么登录？
**A**: 注册成功后会自动填充用户名到登录表单，直接输入密码登录即可

---

## 📁 修改的文件

### 前端
1. ✅ `src/api/user.js` - 添加发送验证码API
2. ✅ `src/views/Login.vue` - 完整重构登录注册页面

### 后端（已完成）
1. ✅ `SmsCodeService.java`
2. ✅ `SmsCodeServiceImpl.java`
3. ✅ `UserController.java`
4. ✅ `UserServiceImpl.java`

---

## 🚀 启动测试

### 1. 启动后端服务

```bash
# 用户服务
cd im-user-service
mvn spring-boot:run
```

### 2. 启动前端

```bash
cd im-frontend
npm run dev
```

### 3. 访问页面

打开浏览器访问: http://localhost:5173/login

### 4. 测试流程

**测试注册**：
1. 点击"立即注册"
2. 输入手机号 `13900000001`
3. 点击"获取验证码"
4. 查看后端控制台复制验证码
5. 填写其他信息并提交

**测试验证码登录**：
1. 切换到"验证码登录"
2. 输入刚注册的手机号
3. 获取并输入验证码
4. 点击登录

**测试密码登录**：
1. 切换到"密码登录"
2. 输入用户名或手机号
3. 输入密码
4. 点击登录

---

## ✨ 亮点功能

1. **智能识别**：自动判断输入的是用户名还是手机号
2. **Tab切换**：流畅的登录方式切换体验
3. **倒计时提示**：清晰的倒计时显示，防止重复点击
4. **表单验证**：完善的前端验证，减少无效请求
5. **自动填充**：注册成功后自动填充用户名
6. **回车登录**：支持按回车键快速登录
7. **友好提示**：所有操作都有明确的成功/失败提示

---

## 📖 相关文档

- 后端实现: `验证码登录注册功能说明.md`
- API文档: `API接口设计.md`
- 组件文档: Element Plus官网
