server:
  port: 8082

spring:
  application:
    name: im-message-service
  profiles:
    active: dev
  
  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/im_chat?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
    username: ${im.datasource.username}
    password: ${im.datasource.password}
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,wall
  
  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      password: ${im.redis.password}
      database: 1
      timeout: 5000
      lettuce:
        pool:
          max-active: 100
          max-idle: 50
          min-idle: 10
          max-wait: 3000
  
  # Kafka配置
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      acks: all
      retries: 3
      batch-size: 16384
      buffer-memory: 33554432
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      properties:
        max.block.ms: 10000
        request.timeout.ms: 10000
        delivery.timeout.ms: 15000
        metadata.max.age.ms: 5000
    consumer:
      group-id: im-message-consumer
      enable-auto-commit: false
      max-poll-records: 100
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      auto-offset-reset: earliest
    listener:
      ack-mode: manual
      concurrency: 3

# MyBatis配置
mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.im.message.entity
  configuration:
    map-underscore-to-camel-case: true
    # log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl  # 关闭SQL详细日志

# JWT配置
jwt:
  secret: ${im.jwt.secret}
  expiration: 604800000

# 日志配置
logging:
  level:
    root: WARN
    com.im.message: INFO
    org.springframework.web: WARN
    org.springframework.messaging: WARN
    org.springframework.websocket: WARN
    org.mybatis: WARN
    com.alibaba.druid: WARN

# 自定义配置
im:
  oss:
    # OSS 服务访问域名，例如：https://oss-cn-hangzhou.aliyuncs.com
    endpoint: https://oss-cn-hangzhou.aliyuncs.com
    # 访问密钥，请不要提交真实值到公共仓库，推荐用环境变量或本地 yml 覆盖
    access-key-id: your-access-key-id
    access-key-secret: your-access-key-secret
    # 存储语音等 IM 文件的 Bucket 名称
    bucket-name: your-bucket-name
    # 对外访问域名（可选，支持自定义域名/CDN 加速域名），末尾不加斜杠
    domain: https://your-bucket-name.oss-cn-hangzhou.aliyuncs.com
  message:
    # 会话缓存消息数量
    conv-cache-size: 1000
    # Redis缓存过期时间（分钟）
    cache-expire-minutes: 30
    # 消息撤回时间限制（分钟）
    recall-time-limit: 5
    # Kafka Topic
    kafka-topic: im-message-private
    # Kafka分区数
    kafka-partitions: 10
