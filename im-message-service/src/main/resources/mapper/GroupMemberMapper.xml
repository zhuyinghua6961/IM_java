<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.im.message.mapper.GroupMemberMapper">
    
    <resultMap id="BaseResultMap" type="com.im.message.entity.GroupMember">
        <id column="id" property="id"/>
        <result column="group_id" property="groupId"/>
        <result column="user_id" property="userId"/>
        <result column="role" property="role"/>
        <result column="status" property="status"/>
        <result column="join_time" property="joinTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="mute_until" property="muteUntil"/>
    </resultMap>
    
    <!-- 查询用户在某个群的成员信息 -->
    <select id="selectByGroupIdAndUserId" resultMap="BaseResultMap">
        SELECT id, group_id, user_id, role, status, join_time, update_time, mute_until
        FROM group_member
        WHERE group_id = #{groupId} AND user_id = #{userId}
    </select>
    
    <!-- 查询群成员列表 -->
    <select id="selectByGroupId" resultMap="BaseResultMap">
        SELECT id, group_id, user_id, role, status, join_time, update_time
        FROM group_member
        WHERE group_id = #{groupId} AND status = 1
        ORDER BY join_time ASC
    </select>
    
    <!-- 查询用户所在的所有群组 -->
    <select id="selectByUserId" resultMap="BaseResultMap">
        SELECT id, group_id, user_id, role, status, join_time, update_time
        FROM group_member
        WHERE user_id = #{userId} AND status = 1
    </select>
    
</mapper>
