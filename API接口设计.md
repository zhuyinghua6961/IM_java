# IM Chat System - API æ¥å£è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v2.1  
**æ›´æ–°æ—¶é—´**: 2025-12-02  

**ğŸ“Œ æ¥å£çŠ¶æ€è¯´æ˜**:  
- âœ… **å·²å®ç°** - åŠŸèƒ½å®Œæ•´ï¼Œå·²ä¸Šçº¿å¯ç”¨
- ğŸš§ **è§„åˆ’ä¸­** - è®¾è®¡å®Œæˆï¼Œå¾…å¼€å‘å®ç°  
- âš ï¸ **å¾…ä¼˜åŒ–çš„æ¥å£ï¼ˆ0ä¸ªï¼‰**

æš‚æ— éœ€è¦æ”¹è¿›

---

## ç›®å½•
- [1. æ¥å£è§„èŒƒ](#1-æ¥å£è§„èŒƒ)
- [2. ç”¨æˆ·æœåŠ¡ API](#2-ç”¨æˆ·æœåŠ¡-api-im-user-service)
- [3. å¥½å‹ç®¡ç† API](#3-å¥½å‹ç®¡ç†-api)
- [4. ç¾¤ç»„ç®¡ç† API](#4-ç¾¤ç»„ç®¡ç†-api)
- [5. æ¶ˆæ¯æœåŠ¡ API](#5-æ¶ˆæ¯æœåŠ¡-api-im-message-service)
- [6. ä¼šè¯ç®¡ç† API](#6-ä¼šè¯ç®¡ç†-api)
- [7. é€šçŸ¥æœåŠ¡ API](#7-é€šçŸ¥æœåŠ¡-api)
- [8. é”™è¯¯ç è¯´æ˜](#8-é”™è¯¯ç è¯´æ˜)

---

## 1. æ¥å£è§„èŒƒ

### 1.1 ç»Ÿä¸€å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1704067200000
}
```

### 1.2 çŠ¶æ€ç å®šä¹‰

| çŠ¶æ€ç  | è¯´æ˜ | çŠ¶æ€ |
|--------|------|------|
| 200 | æˆåŠŸ | âœ… |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | âœ… |
| 401 | æœªè®¤è¯ | âœ… |
| 403 | æ— æƒé™ | âœ… |
| 404 | èµ„æºä¸å­˜åœ¨ | âœ… |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | âœ… |
| 1001 | ç”¨æˆ·åå·²å­˜åœ¨ | âœ… |
| 1002 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | âœ… |
| 1003 | Token å·²è¿‡æœŸ | âœ… |
| 2001 | å¥½å‹å·²å­˜åœ¨ | âœ… |
| 2002 | å¥½å‹ç”³è¯·å·²å‘é€ | âœ… |
| 2003 | å¥½å‹ç”³è¯·ä¸å­˜åœ¨ | âœ… |
| 2004 | ä¸èƒ½æ·»åŠ è‡ªå·±ä¸ºå¥½å‹ | âœ… |
| 2005 | å¯¹æ–¹å·²æ‹‰é»‘ä½  | ğŸš§ |
| 3001 | æ¶ˆæ¯å‘é€å¤±è´¥ | âœ… |
| 3002 | æ¶ˆæ¯ä¸å­˜åœ¨ | âœ… |
| 3003 | æ¶ˆæ¯å·²æ’¤å› | âœ… |
| 3004 | æ’¤å›æ—¶é—´å·²è¿‡ | âœ… |
| 3005 | ä¸æ˜¯æ¶ˆæ¯å‘é€è€… | âœ… |
| 4001 | ç¾¤ç»„ä¸å­˜åœ¨ | âœ… |
| 4002 | ä¸æ˜¯ç¾¤æˆå‘˜ | âœ… |
| 4003 | æ— æ“ä½œæƒé™ | âœ… |
| 4004 | ç¾¤ç»„å·²æ»¡ | âœ… |
| 4005 | å·²æ˜¯ç¾¤æˆå‘˜ | âœ… |

### 1.3 è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

---

## 2. ç”¨æˆ·æœåŠ¡ API (im-user-service)

### 2.1 ç”¨æˆ·æ³¨å†Œ âœ…

**æ¥å£åœ°å€**: `POST /api/user/register`

**è¯·æ±‚å‚æ•°**:
```json
{
  "username": "user001",
  "password": "123456",
  "nickname": "å¼ ä¸‰",
  "phone": "13800138000",
  "email": "user001@im.com"
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "userId": 1,
    "username": "user001",
    "nickname": "å¼ ä¸‰",
    "avatar": "https://xxx.com/default.jpg"
  }
}
```

---

### 2.2 ç”¨æˆ·ç™»å½• âœ…

**æ¥å£åœ°å€**: `POST /api/user/login`

**è¯·æ±‚å‚æ•°**:
```json
{
  "username": "user001",
  "password": "123456"
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "userId": 1,
      "username": "user001",
      "nickname": "å¼ ä¸‰",
      "avatar": "https://xxx.com/avatar.jpg",
      "signature": "è¿™æ˜¯æˆ‘çš„ä¸ªæ€§ç­¾å"
    }
  }
}
```

---

### 2.4 ç”¨æˆ·ç™»å‡º âœ…

**æ¥å£åœ°å€**: `POST /api/user/logout`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

---

### 2.5 è·å–ç”¨æˆ·ä¿¡æ¯ âœ…

**æ¥å£åœ°å€**: `GET /api/user/info/{userId}`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "userId": 1,
    "username": "user001",
    "nickname": "å¼ ä¸‰",
    "avatar": "https://xxx.com/avatar.jpg",
    "gender": 1,
    "phone": "13800138000",
    "email": "user001@im.com",
    "signature": "è¿™æ˜¯æˆ‘çš„ä¸ªæ€§ç­¾å",
    "createTime": "2024-01-01 12:00:00"
  }
}
```

---

### 2.5 ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ âœ…

**æ¥å£åœ°å€**: `PUT /api/user/info`

**è¯·æ±‚å‚æ•°**:
```json
{
  "nickname": "å¼ ä¸‰ä¸‰",
  "avatar": "https://xxx.com/new-avatar.jpg",
  "gender": 1,
  "phone": "13800138000",
  "email": "user001@im.com",
  "signature": "æ–°çš„ä¸ªæ€§ç­¾å"
}
```

---

### 2.6 æœç´¢ç”¨æˆ· âœ…

**æ¥å£åœ°å€**: `GET /api/user/search?keyword={keyword}`

**è¯´æ˜**: æ ¹æ®ç”¨æˆ·åæˆ–æ‰‹æœºå·ç²¾ç¡®æœç´¢ç”¨æˆ·

**è¯·æ±‚å‚æ•°**:
- `keyword`: ç”¨æˆ·åæˆ–æ‰‹æœºå·ï¼ˆå¿…å¡«ï¼‰

**å“åº”æ•°æ®ï¼ˆæ‰¾åˆ°ç”¨æˆ·ï¼‰**:
```json
{
  "code": 200,
  "data": [
    {
      "userId": 1,
      "username": "user001",
      "nickname": "å¼ ä¸‰",
      "avatar": "https://xxx.com/avatar.jpg",
      "gender": 1,
      "signature": "è¿™æ˜¯ä¸ªæ€§ç­¾å"
    }
  ]
}
```

---

### 2.7 å‘é€çŸ­ä¿¡éªŒè¯ç  âœ…

**æ¥å£åœ°å€**: `POST /api/user/sms/send`

**è¯·æ±‚å‚æ•°**:

```json
{
  "phone": "13800138000"
}
```

**è¯´æ˜**:
- å‘æŒ‡å®šæ‰‹æœºå·å‘é€ 6 ä½æ•°å­—éªŒè¯ç 
- åŒä¸€æ‰‹æœºå·å‘é€é¢‘ç‡é™åˆ¶ï¼ˆå¦‚ 60s å†…åªèƒ½å‘é€ä¸€æ¬¡ï¼‰

---

### 2.8 ä¿®æ”¹å¯†ç  âœ…

**æ¥å£åœ°å€**: `POST /api/user/password/change`

**è¯´æ˜**: éœ€åŒæ—¶æ ¡éªŒåŸå¯†ç  + çŸ­ä¿¡éªŒè¯ç 

**è¯·æ±‚å‚æ•°**:

```json
{
  "oldPassword": "123456",        // åŸå¯†ç 
  "newPassword": "654321",        // æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
  "code": "123456"                // çŸ­ä¿¡éªŒè¯ç 
}
```

**ä¸šåŠ¡è§„åˆ™**:
- å½“å‰ç™»å½•ç”¨æˆ·æ‰èƒ½ä¿®æ”¹è‡ªå·±çš„å¯†ç 
- è´¦å·å¿…é¡»å·²ç»‘å®šæ‰‹æœºå·
- åŸå¯†ç é”™è¯¯æ—¶è¿”å›ä¸šåŠ¡é”™è¯¯ç  `1002`/`PASSWORD_ERROR`
- éªŒè¯ç é”™è¯¯æˆ–è¿‡æœŸè¿”å› `400 BAD_REQUEST`

---

## 3. å¥½å‹ç®¡ç† API

### 3.1 è·å–å¥½å‹åˆ—è¡¨ âœ…

**æ¥å£åœ°å€**: `GET /api/friend/list`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": [
    {
      "userId": 2,
      "username": "user002",
      "nickname": "æå››",
      "remark": "æˆ‘çš„å¥½å‹",
      "avatar": "https://xxx.com/avatar.jpg",
      "gender": 1,
      "signature": "ä¸ªæ€§ç­¾å",
      "online": false
    }
  ]
}
```

---

### 3.2 å‘é€å¥½å‹ç”³è¯· âœ…

**æ¥å£åœ°å€**: `POST /api/friend/request`

**è¯·æ±‚å‚æ•°**:
```json
{
  "friendId": 2,
  "message": "ä½ å¥½ï¼Œæˆ‘æƒ³åŠ ä½ ä¸ºå¥½å‹"
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "fromUserId": 1,
    "toUserId": 2,
    "message": "ä½ å¥½ï¼Œæˆ‘æƒ³åŠ ä½ ä¸ºå¥½å‹",
    "status": 0,
    "createTime": "2024-01-01 12:00:00"
  }
}
```

---

### 3.3 è·å–å¥½å‹ç”³è¯·åˆ—è¡¨ âœ…

**æ¥å£åœ°å€**: `GET /api/friend/request/list`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "fromUserId": 2,
      "toUserId": 1,
      "message": "ä½ å¥½ï¼Œæˆ‘æƒ³åŠ ä½ ä¸ºå¥½å‹",
      "status": 0,
      "createTime": "2024-01-01 12:00:00"
    }
  ]
}
```

---

### 3.4 å¤„ç†å¥½å‹ç”³è¯· âœ…

**æ¥å£åœ°å€**: `POST /api/friend/request/handle`

**è¯·æ±‚å‚æ•°**:
```json
{
  "requestId": 1,
  "status": 1  // 1-åŒæ„ 2-æ‹’ç»
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "status": 1
  }
}
```

---

### 3.5 åˆ é™¤å¥½å‹ âœ…

**æ¥å£åœ°å€**: `DELETE /api/friend/{friendId}`

**è¯´æ˜**: åŒå‘åˆ é™¤å¥½å‹å…³ç³»

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

---

### 3.6 ä¿®æ”¹å¥½å‹å¤‡æ³¨ âœ…

**æ¥å£åœ°å€**: `POST /api/friend/remark`

**è¯´æ˜**: ä¸ºå½“å‰ç™»å½•ç”¨æˆ·ä¿®æ”¹æŸä¸ªå¥½å‹çš„å¤‡æ³¨å

**è¯·æ±‚å‚æ•°**:

```json
{
  "friendId": 2,
  "remark": "è€åŒå­¦å¼ ä¸‰"   // ä¸ºç©ºæˆ– null è¡¨ç¤ºæ¸…é™¤å¤‡æ³¨
}
```

**å“åº”æ•°æ®**:

```json
{
  "code": 200,
  "message": "success"
}
```

**ä¸šåŠ¡è§„åˆ™**:
- `friendId` å¿…é¡»æ˜¯å½“å‰ç”¨æˆ·çš„æœ‰æ•ˆå¥½å‹
- å¤‡æ³¨åªå¯¹å½“å‰ç”¨æˆ·å¯è§ï¼Œä¸ä¼šå½±å“å¯¹æ–¹çœ‹åˆ°çš„æ˜µç§°

---

### 3.7 æ‹‰é»‘/å–æ¶ˆæ‹‰é»‘å¥½å‹ ğŸš§

**æ¥å£åœ°å€**: `POST /api/friend/{friendId}/block`

**è¯·æ±‚å‚æ•°**:
```json
{
  "block": true  // true-æ‹‰é»‘ false-å–æ¶ˆæ‹‰é»‘
}
```

**è¯´æ˜**: å¾…å®ç°åŠŸèƒ½ï¼Œéœ€è¦åˆ›å»º `blacklist` è¡¨

---

## 4. ç¾¤ç»„ç®¡ç† API

### 4.1 åˆ›å»ºç¾¤ç»„ âœ…

**æ¥å£åœ°å€**: `POST /api/group/create`

**è¯·æ±‚å‚æ•°**:
```json
{
  "groupName": "æŠ€æœ¯äº¤æµç¾¤",
  "avatar": "https://xxx.com/group-avatar.jpg",
  "notice": "æ¬¢è¿å¤§å®¶åŠ å…¥",
  "maxMembers": 500,
  "memberIds": [2, 3, 4]
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "groupId": 1,
    "groupName": "æŠ€æœ¯äº¤æµç¾¤",
    "avatar": "https://xxx.com/group-avatar.jpg",
    "ownerId": 1,
    "ownerName": "å¼ ä¸‰",
    "memberCount": 4,
    "maxMembers": 500,
    "notice": "æ¬¢è¿å¤§å®¶åŠ å…¥",
    "createTime": "2024-01-01 12:00:00"
  }
}
```

---

### 4.2 è·å–ç¾¤ç»„åˆ—è¡¨ âœ…

**æ¥å£åœ°å€**: `GET /api/group/list`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": [
    {
      "groupId": 1,
      "groupName": "æŠ€æœ¯äº¤æµç¾¤",
      "avatar": "https://xxx.com/group-avatar.jpg",
      "ownerId": 1,
      "ownerName": "å¼ ä¸‰",
      "memberCount": 100,
      "maxMembers": 500,
      "notice": "æ¬¢è¿å¤§å®¶"
    }
  ]
}
```

---

### 4.3 è·å–ç¾¤ç»„è¯¦æƒ… âœ…

**æ¥å£åœ°å€**: `GET /api/group/detail/{groupId}`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "groupId": 1,
    "groupName": "æŠ€æœ¯äº¤æµç¾¤",
    "avatar": "https://xxx.com/group-avatar.jpg",
    "ownerId": 1,
    "ownerName": "å¼ ä¸‰",
    "notice": "æ¬¢è¿å¤§å®¶",
    "memberCount": 100,
    "maxMembers": 500,
    "createTime": "2024-01-01 12:00:00"
  }
}
```

---

### 4.4 ä¿®æ”¹ç¾¤ç»„ä¿¡æ¯ âœ…

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/update`

**æƒé™**: ä»…ç¾¤ä¸»å¯æ“ä½œ

**è¯·æ±‚å‚æ•°**:
```json
{
  "groupName": "æ–°ç¾¤åç§°",
  "avatar": "https://xxx.com/new-avatar.jpg",
  "notice": "æ–°å…¬å‘Š",
  "maxMembers": 1000
}
```

**å“åº”æ•°æ®**: è¿”å›æ›´æ–°åçš„ç¾¤ç»„è¯¦æƒ…

---

### 4.5 é‚€è¯·ç”¨æˆ·åŠ å…¥ç¾¤ç»„ âœ…

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/invite`

**æƒé™**: ç¾¤ä¸»/ç®¡ç†å‘˜/æ™®é€šæˆå‘˜ï¼ˆæ ¹æ®é…ç½®ï¼‰

**è¯·æ±‚å‚æ•°**:
```json
[5, 6, 7]  // ç”¨æˆ·IDæ•°ç»„
```

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "groupId": 1,
    "groupName": "æŠ€æœ¯äº¤æµç¾¤",
    "memberCount": 103
  }
}
```

**è¯´æ˜**: 
- ç™½åå•ç”¨æˆ·ç›´æ¥åŠ å…¥
- éç™½åå•ç”¨æˆ·éœ€è¦ç®¡ç†å‘˜å®¡æ‰¹

---

### 4.6 è·å–æˆ‘çš„ç¾¤ç»„é‚€è¯·åˆ—è¡¨ âœ…

**æ¥å£åœ°å€**: `GET /api/group/invitations`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": [
    {
      "invitationId": 1,
      "groupId": 1,
      "groupName": "æŠ€æœ¯äº¤æµç¾¤",
      "inviterId": 2,
      "inviterName": "æå››",
      "status": 1,
      "createTime": "2024-01-01 12:00:00",
      "expireTime": "2024-01-08 12:00:00"
    }
  ]
}
```

---

### 4.7 å¤„ç†ç¾¤ç»„é‚€è¯· âœ…

**æ¥å£åœ°å€**: `POST /api/group/invitation/handle`

**è¯·æ±‚å‚æ•°**:
```json
{
  "invitationId": 1,
  "accept": true  // true-åŒæ„ false-æ‹’ç»
}
```

---

### 4.8 ç®¡ç†å‘˜å®¡æ‰¹é‚€è¯· âœ…

**æ¥å£åœ°å€**: `POST /api/group/invitation/{invitationId}/approve`

**æƒé™**: ä»…ç¾¤ä¸»/ç®¡ç†å‘˜

**è¯·æ±‚å‚æ•°**:
```json
{
  "approve": true  // true-é€šè¿‡ false-æ‹’ç»
}
```

---

### 4.9 è·å–ç¾¤ç»„æˆå‘˜åˆ—è¡¨ âœ…

**æ¥å£åœ°å€**: `GET /api/group/{groupId}/members`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": [
    {
      "userId": 1,
      "nickname": "å¼ ä¸‰",
      "avatar": "https://xxx.com/avatar.jpg",
      "role": 2,  // 0-æ™®é€šæˆå‘˜ 1-ç®¡ç†å‘˜ 2-ç¾¤ä¸»
      "joinTime": "2024-01-01 12:00:00"
    }
  ]
}
```

---

### 4.10 è®¾ç½®/å–æ¶ˆç®¡ç†å‘˜ âœ…

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/admin`

**æƒé™**: ä»…ç¾¤ä¸»

**è¯·æ±‚å‚æ•°**:
```json
{
  "userId": 5,
  "isAdmin": true  // true-è®¾ç½®ä¸ºç®¡ç†å‘˜ false-å–æ¶ˆç®¡ç†å‘˜
}
```

---

### 4.11 ç§»é™¤ç¾¤æˆå‘˜ âœ…

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/remove`

**æƒé™**: ç¾¤ä¸»/ç®¡ç†å‘˜

**è¯·æ±‚å‚æ•°**:
```json
{
  "userId": 5
}
```

**è¯´æ˜**:
- ç¾¤ä¸»å¯ç§»é™¤ä»»ä½•æˆå‘˜
- ç®¡ç†å‘˜åªèƒ½ç§»é™¤æ™®é€šæˆå‘˜
- ä¸èƒ½ç§»é™¤ç¾¤ä¸»å’Œè‡ªå·±

---

### 4.12 é€€å‡ºç¾¤ç»„ âœ…

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/quit`

**è¯´æ˜**: ç¾¤ä¸»ä¸èƒ½é€€å‡ºï¼Œåªèƒ½è§£æ•£ç¾¤ç»„

---

### 4.13 è§£æ•£ç¾¤ç»„ âœ…

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/dissolve`

**æƒé™**: ä»…ç¾¤ä¸»

**è¯´æ˜**: è§£æ•£åæ‰€æœ‰æˆå‘˜è¢«ç§»é™¤ï¼Œç¾¤ç»„çŠ¶æ€å˜ä¸ºå·²è§£æ•£

---

### 4.14 è½¬è®©ç¾¤ä¸» ğŸš§

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/transfer`

**æƒé™**: ä»…ç¾¤ä¸»

**è¯·æ±‚å‚æ•°**:
```json
{
  "newOwnerId": 5
}
```

**è¯´æ˜**: å¾…å®ç°åŠŸèƒ½

---

### 4.15 ä¿®æ”¹ç¾¤æ˜µç§° ğŸš§

**æ¥å£åœ°å€**: `PUT /api/group/{groupId}/member/nickname`

**è¯·æ±‚å‚æ•°**:
```json
{
  "nickname": "æˆ‘çš„ç¾¤æ˜µç§°"
}
```

**è¯´æ˜**: å¾…å®ç°åŠŸèƒ½

---

### 4.16 ç¦è¨€ç¾¤æˆå‘˜ ğŸš§

**æ¥å£åœ°å€**: `POST /api/group/{groupId}/mute`

**æƒé™**: ç¾¤ä¸»/ç®¡ç†å‘˜

**è¯·æ±‚å‚æ•°**:
```json
{
  "userId": 5,
  "muteUntil": "2024-01-08 12:00:00"  // ç¦è¨€æˆªæ­¢æ—¶é—´ï¼Œnullè¡¨ç¤ºå–æ¶ˆç¦è¨€
}
```

**è¯´æ˜**: å¾…å®ç°åŠŸèƒ½

---

## 5. æ¶ˆæ¯æœåŠ¡ API (im-message-service)

### 5.1 WebSocket è¿æ¥ âœ…

**è¿æ¥åœ°å€**: `ws://domain/ws?token={jwt_token}`

**è¯´æ˜**: 
- ä½¿ç”¨ STOMP åè®®
- è®¢é˜…åœ°å€: `/user/queue/messages`
- å‘é€åœ°å€: `/app/chat`

---

### 5.2 è·å–å†å²æ¶ˆæ¯ âœ…

**æ¥å£åœ°å€**: `GET /api/message/history`

**è¯·æ±‚å‚æ•°**:
- `targetId`: å¯¹æ–¹IDï¼ˆç”¨æˆ·IDæˆ–ç¾¤ç»„IDï¼‰
- `chatType`: èŠå¤©ç±»å‹ï¼ˆ1-å•èŠ 2-ç¾¤èŠï¼‰
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `size`: æ¯é¡µå¤§å°ï¼ˆé»˜è®¤20ï¼‰

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "total": 100,
    "list": [
      {
        "id": 123456,
        "fromUserId": 1,
        "toId": 2,
        "chatType": 1,
        "msgType": 1,
        "content": "Hello",
        "url": null,
        "status": 1,
        "sendTime": "2024-01-01 12:00:00",
        "recallTime": null
      }
    ]
  }
}
```

---

### 5.3 æ’¤å›æ¶ˆæ¯ âœ…

**æ¥å£åœ°å€**: `POST /api/message/recall`

**è¯·æ±‚å‚æ•°**:
```json
{
  "messageId": 123456
}
```

**è¯´æ˜**: 
- åªèƒ½æ’¤å›è‡ªå·±çš„æ¶ˆæ¯
- æ’¤å›æ—¶é—´é™åˆ¶5åˆ†é’Ÿ

---

### 5.4 æ ‡è®°æ¶ˆæ¯å·²è¯» âœ…

**æ¥å£åœ°å€**: `POST /api/message/read`

**è¯·æ±‚å‚æ•°**:
```json
{
  "messageIds": [123456, 123457, 123458]
}
```

---

### 5.5 åˆ é™¤å•æ¡æ¶ˆæ¯ âœ…

**æ¥å£åœ°å€**: `DELETE /api/message/{messageId}`

**è¯´æ˜**: 
- **å•å‘åˆ é™¤**ï¼šåªå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œå¯¹æ–¹ä¸å—å½±å“
- åˆ é™¤åè¯¥æ¶ˆæ¯ä¸ä¼šåœ¨å†å²è®°å½•ä¸­æ˜¾ç¤º
- å•èŠï¼šå‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½å¯ä»¥åˆ é™¤
- ç¾¤èŠï¼šç¾¤æˆå‘˜å¯ä»¥åˆ é™¤

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

---

### 5.6 æ–‡ä»¶ä¸Šä¼ ï¼ˆåª’ä½“/æ–‡ä»¶ï¼‰ âœ…

**æ¥å£å‰ç¼€**: `im-message-service`

#### 5.6.1 ä¸Šä¼ è¯­éŸ³

**æ¥å£åœ°å€**: `POST /api/files/upload/audio`

**è¯·æ±‚ç±»å‹**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| file | File | è¯­éŸ³æ–‡ä»¶ï¼Œå»ºè®®æ ¼å¼ mp3/aac/m4a |

**å“åº”æ•°æ®**:

```json
{
  "code": 200,
  "data": {
    "url": "https://oss-bucket/voice/2025/12/02/xxx.mp3",
    "size": 12345,
    "fileName": "voice.mp3"
  }
}
```

#### 5.6.2 ä¸Šä¼ å›¾ç‰‡

**æ¥å£åœ°å€**: `POST /api/files/upload/image`

**è¯·æ±‚ç±»å‹**: `multipart/form-data`

**è¯´æ˜**: èŠå¤©å›¾ç‰‡ã€ç”¨æˆ·å¤´åƒç­‰å‡ä½¿ç”¨è¯¥æ¥å£ä¸Šä¼ åˆ° OSSã€‚

**å“åº”ç»“æ„**ä¸ä¸Šä¼ è¯­éŸ³ä¸€è‡´ã€‚

#### 5.6.3 ä¸Šä¼ è§†é¢‘

**æ¥å£åœ°å€**: `POST /api/files/upload/video`

**è¯·æ±‚ç±»å‹**: `multipart/form-data`

**è¯´æ˜**: èŠå¤©è§†é¢‘æ¶ˆæ¯ä¸Šä¼ åˆ° OSSã€‚

**å“åº”ç»“æ„**ä¸ä¸Šä¼ è¯­éŸ³ä¸€è‡´ã€‚

#### 5.6.4 ä¸Šä¼ é€šç”¨æ–‡ä»¶

**æ¥å£åœ°å€**: `POST /api/files/upload/file`

**è¯·æ±‚ç±»å‹**: `multipart/form-data`

**è¯´æ˜**: èŠå¤©æ–‡ä»¶æ¶ˆæ¯ï¼ˆå¦‚ pdf/doc/zipï¼‰ï¼›å‰ç«¯æ ¹æ® `url` æä¾›ä¸‹è½½/æ‰“å¼€åŠŸèƒ½ã€‚

**å“åº”ç»“æ„**ä¸ä¸Šä¼ è¯­éŸ³ä¸€è‡´ã€‚

---

### 5.7 æ¶ˆæ¯æœç´¢ ğŸš§

**æ¥å£åœ°å€**: `GET /api/message/search`

**è¯·æ±‚å‚æ•°**:
- `keyword`: æœç´¢å…³é”®è¯
- `chatType`: èŠå¤©ç±»å‹ï¼ˆå¯é€‰ï¼‰
- `targetId`: å¯¹æ–¹IDï¼ˆå¯é€‰ï¼‰
- `startTime`: å¼€å§‹æ—¶é—´ï¼ˆå¯é€‰ï¼‰
- `endTime`: ç»“æŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰

**è¯´æ˜**: å¾…å®ç°åŠŸèƒ½

---

## 6. ä¼šè¯ç®¡ç† API

### 6.1 è·å–ä¼šè¯åˆ—è¡¨ âœ…

**æ¥å£åœ°å€**: `GET /api/conversation/list`

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": [
    {
      "conversationId": "1-2",
      "targetId": 2,
      "chatType": 1,
      "targetName": "æå››",
      "targetAvatar": "https://xxx.com/avatar.jpg",
      "lastMessage": "Hello",
      "lastMsgTime": "2024-01-01 12:00:00",
      "unreadCount": 5,
      "top": false
    }
  ]
}
```

---

### 6.2 æ¸…ç©ºæœªè¯»æ•° âœ…

**æ¥å£åœ°å€**: `POST /api/conversation/clear-unread`

**è¯·æ±‚å‚æ•°**:
```json
{
  "targetId": 2,
  "chatType": 1
}
```

---

### 6.3 ç½®é¡¶ä¼šè¯ âœ…

**æ¥å£åœ°å€**: `POST /api/conversation/top`

**è¯·æ±‚å‚æ•°**:
```json
{
  "conversationId": 1,
  "top": true
}
```

---

### 6.4 éšè—ä¼šè¯ âœ…

**æ¥å£åœ°å€**: `POST /api/conversation/hide`

**è¯´æ˜**ï¼š
- ä¼šè¯ä»åˆ—è¡¨ä¸­ç§»é™¤ï¼Œä½†ä¸åˆ é™¤èŠå¤©è®°å½•
- æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶ä¼šè¯è‡ªåŠ¨æ¢å¤æ˜¾ç¤º
- ä¿ç•™æœªè¯»æ•°å’Œç½®é¡¶çŠ¶æ€

**è¯·æ±‚å‚æ•°**:
```json
{
  "conversationId": "1-2"  // æ”¯æŒæ ¼å¼: chatType-targetId
}
```

**ğŸ’¡ ä½¿ç”¨åœºæ™¯**ï¼šæš‚æ—¶ä¸æƒ³çœ‹æŸä¸ªä¼šè¯ï¼Œä½†ä¿ç•™èŠå¤©è®°å½•

---

### 6.5 åˆ é™¤ä¼šè¯ âœ…

**æ¥å£åœ°å€**: `DELETE /api/conversation/{conversationId}`

**è¯´æ˜**: 
- **åªåˆ é™¤ä¼šè¯è®°å½•ï¼Œä¸åˆ é™¤æ¶ˆæ¯**
- åˆ é™¤åä½ å°†çœ‹ä¸åˆ°è¿™ä¸ªä¼šè¯å’Œæ‰€æœ‰èŠå¤©è®°å½•
- **å¯¹æ–¹å®Œå…¨ä¸å—å½±å“**ï¼Œå¯¹æ–¹ä»èƒ½çœ‹åˆ°æ‰€æœ‰æ¶ˆæ¯
- å¦‚æœå¯¹æ–¹å†å‘æ¶ˆæ¯ï¼Œä¼šè¯ä¼šé‡æ–°å‡ºç°ï¼ˆä½†ä¹‹å‰çš„æ¶ˆæ¯ä¹Ÿä¼šé‡æ–°å¯è§ï¼‰
- åˆ é™¤åä¸å¯æ¢å¤

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

**âš ï¸ é‡è¦æç¤º**ï¼š
- è¿™æ˜¯**å•å‘åˆ é™¤**ï¼šåªå½±å“ä½ è‡ªå·±ï¼Œå¯¹æ–¹å®Œå…¨ä¸å—å½±å“
- æ¶ˆæ¯å®é™…ä¸Šè¿˜åœ¨æ•°æ®åº“ä¸­ï¼Œåªæ˜¯ä½ çœ‹ä¸åˆ°äº†
- å¦‚æœéœ€è¦å½»åº•æ¸…ç©ºï¼Œåº”è¯¥ä½¿ç”¨"éšè—ä¼šè¯"åŠŸèƒ½

---

## 7. é€šçŸ¥æœåŠ¡ API

### 7.1 æ¨é€é€šçŸ¥ âœ…

**æ¥å£åœ°å€**: `POST /api/notification/push`

**è¯´æ˜**: å†…éƒ¨æœåŠ¡è°ƒç”¨ï¼Œç”¨äºWebSocketé€šçŸ¥æ¨é€

**è¯·æ±‚å‚æ•°**:
```json
{
  "type": "FRIEND_REQUEST",
  "receiverId": 2,
  "data": {
    "requestId": 1,
    "fromUserId": 1,
    "fromUserName": "å¼ ä¸‰",
    "message": "ä½ å¥½"
  }
}
```

**é€šçŸ¥ç±»å‹**:
- `FRIEND_REQUEST`: å¥½å‹ç”³è¯·
- `FRIEND_REQUEST_ACCEPTED`: å¥½å‹ç”³è¯·é€šè¿‡
- `GROUP_INVITATION`: ç¾¤ç»„é‚€è¯·
- `GROUP_ADMIN_CHANGE`: ç¾¤ç®¡ç†å‘˜å˜æ›´
- `GROUP_MEMBER_REMOVED`: ç¾¤æˆå‘˜è¢«ç§»é™¤
- `GROUP_MEMBER_QUIT`: ç¾¤æˆå‘˜é€€å‡º
- `GROUP_DIRECT_JOIN`: ç›´æ¥åŠ å…¥ç¾¤ç»„
- `GROUP_DISSOLVED`: ç¾¤ç»„è§£æ•£

---

## 8. é”™è¯¯ç è¯´æ˜

### 8.1 é€šç”¨é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 200 | æˆåŠŸ | - |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•° |
| 401 | æœªè®¤è¯ | é‡æ–°ç™»å½•è·å– Token |
| 403 | æ— æƒé™ | æ£€æŸ¥ç”¨æˆ·æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥èµ„æº ID |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | è”ç³»ç®¡ç†å‘˜ |

### 8.2 ä¸šåŠ¡é”™è¯¯ç 

| æ¨¡å— | é”™è¯¯ç  | è¯´æ˜ |
|------|--------|------|
| ç”¨æˆ· | 1001 | ç”¨æˆ·åå·²å­˜åœ¨ |
| ç”¨æˆ· | 1002 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ |
| ç”¨æˆ· | 1003 | Token å·²è¿‡æœŸ |
| å¥½å‹ | 2001 | å¥½å‹å·²å­˜åœ¨ |
| å¥½å‹ | 2002 | å¥½å‹ç”³è¯·å·²å‘é€ |
| å¥½å‹ | 2003 | å¥½å‹ç”³è¯·ä¸å­˜åœ¨ |
| å¥½å‹ | 2004 | ä¸èƒ½æ·»åŠ è‡ªå·±ä¸ºå¥½å‹ |
| å¥½å‹ | 2005 | å¯¹æ–¹å·²æ‹‰é»‘ä½  |
| æ¶ˆæ¯ | 3001 | æ¶ˆæ¯å‘é€å¤±è´¥ |
| æ¶ˆæ¯ | 3002 | æ¶ˆæ¯ä¸å­˜åœ¨ |
| æ¶ˆæ¯ | 3003 | æ¶ˆæ¯å·²æ’¤å› |
| æ¶ˆæ¯ | 3004 | æ’¤å›æ—¶é—´å·²è¿‡ |
| æ¶ˆæ¯ | 3005 | ä¸æ˜¯æ¶ˆæ¯å‘é€è€… |
| ç¾¤ç»„ | 4001 | ç¾¤ç»„ä¸å­˜åœ¨ |
| ç¾¤ç»„ | 4002 | ä¸æ˜¯ç¾¤æˆå‘˜ |
| ç¾¤ç»„ | 4003 | æ— æ“ä½œæƒé™ |
| ç¾¤ç»„ | 4004 | ç¾¤ç»„å·²æ»¡ |
| ç¾¤ç»„ | 4005 | å·²æ˜¯ç¾¤æˆå‘˜ |

---

## 9. å¾…å®ç°åŠŸèƒ½æ¸…å•

### ä¼˜å…ˆçº§ P0ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

- [ ] åœ¨çº¿çŠ¶æ€æ˜¾ç¤º
- [ ] ç¾¤ä¸»è½¬è®©
- [ ] ç¾¤æ˜µç§°ä¿®æ”¹

### ä¼˜å…ˆçº§ P1ï¼ˆé‡è¦åŠŸèƒ½ï¼‰

- [ ] æ‹‰é»‘åŠŸèƒ½
- [ ] ç¾¤æˆå‘˜ç¦è¨€
- [ ] æ¶ˆæ¯@æé†’
- [ ] ç¾¤å…¬å‘Šå†å²è®°å½•

### ä¼˜å…ˆçº§ P2ï¼ˆä¼˜åŒ–åŠŸèƒ½ï¼‰

- [ ] æ¶ˆæ¯æœç´¢
- [ ] æ¶ˆæ¯è½¬å‘
- [ ] ç¾¤ç»„æœç´¢
- [ ] æ¶ˆæ¯ç½®é¡¶
- [ ] æ–‡ä»¶ä¸‹è½½ç®¡ç†

### ä¼˜å…ˆçº§ P3ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰

- [ ] é˜…åå³ç„š
- [ ] è¯­éŸ³é€šè¯
- [ ] è§†é¢‘é€šè¯
- [ ] æœ‹å‹åœˆåŠŸèƒ½

---

## 10. ç‰ˆæœ¬æ›´æ–°è®°å½•

### v2.0.0 (2025-11-27)
- âœ… å®Œå–„ç¾¤ç»„ç®¡ç†åŠŸèƒ½
  - ä¿®æ”¹ç¾¤ä¿¡æ¯ï¼ˆç¾¤ä¸»ä¸“ç”¨ï¼‰
  - ç§»é™¤ç¾¤æˆå‘˜
  - è®¾ç½®/å–æ¶ˆç®¡ç†å‘˜
  - è§£æ•£ç¾¤ç»„
  - ç¾¤ç»„é‚€è¯·å®¡æ‰¹æµç¨‹
- âœ… å®Œå–„å¥½å‹åŠŸèƒ½
  - åˆ é™¤å¥½å‹
- âœ… å®Œå–„æ¶ˆæ¯åŠŸèƒ½
  - æ¶ˆæ¯æ’¤å›
  - æ¶ˆæ¯å·²è¯»
  - å†å²æ¶ˆæ¯åˆ†é¡µ
  - åˆ é™¤å•æ¡æ¶ˆæ¯ï¼ˆå•å‘åˆ é™¤ï¼‰
- âœ… å®Œå–„ä¼šè¯åŠŸèƒ½
  - ä¼šè¯ç½®é¡¶
  - ä¼šè¯éšè—
  - æ¸…ç©ºæœªè¯»
  - åˆ é™¤ä¼šè¯ï¼ˆå•å‘åˆ é™¤ï¼Œåªå½±å“å½“å‰ç”¨æˆ·ï¼‰
- âœ… WebSocket é€šçŸ¥ç³»ç»Ÿ
  - å¥½å‹ç”³è¯·é€šçŸ¥
  - ç¾¤ç»„é€šçŸ¥
  - ç³»ç»Ÿé€šçŸ¥
- ğŸ“ æ›´æ–°å®Œæ•´æ¥å£æ–‡æ¡£

### v1.0.0 (2024-01-01)
- åˆå§‹ç‰ˆæœ¬
- åŸºç¡€ç”¨æˆ·ã€å¥½å‹ã€ç¾¤ç»„ã€æ¶ˆæ¯åŠŸèƒ½

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·åœ¨å®ç°æ–°åŠŸèƒ½æˆ–ä¿®æ”¹æ¥å£æ—¶åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£  
**è”ç³»æ–¹å¼**: dev@example.com
